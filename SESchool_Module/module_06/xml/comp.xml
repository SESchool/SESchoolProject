<?xml version="1.0" encoding="EUC-KR" ?>

<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
	"http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- WARNING: This is an autogenerated file -->

<sqlMap namespace="T_LMS_comp">
		<resultMap id="selectFostertraining" class="cmap">
			<result property="FOSTERSEQ"	column="FOSTERSEQ" />
			<result property="BUSINESSNM"	column="BUSINESSNM" />
			<result property="COUNSELDATE"  column="COUNSELDATE" />
			<result property="REGIONCD"     column="REGIONCD"  />
			<result property="REGIONNM"     column="REGIONNM" />
			<result property="NAME"         column="NAME" />
			<result property="JIKUPNM"      column="JIKUPNM" />
			<result property="DEPTNM"       column="DEPTNM" />
			<result property="TELNO"        column="TELNO" />
			<result property="HANDPHONE"    column="HANDPHONE" />
			<result property="EMAIL"        column="EMAIL" />
			<result property="PERIODS"      column="PERIODS" />
			<result property="PERIODE"      column="PERIODE"  />
			<result property="TOTALTIME"    column="TOTALTIME" />
			<result property="DAYS"         column="DAYS" />
			<result property="WEEKDAY"      column="WEEKDAY" />
			<result property="TIMESLOT"     column="TIMESLOT" />
			<result property="FOSTERNO"     column="FOSTERNO" />
			<result property="PLACE"        column="PLACE" />
			<result property="ISGOYONG"     column="ISGOYONG" />
			<result property="RCVARADDR"    column="RCVARADDR" />
			<result property="CONTENTS"     column="CONTENTS" />
			<result property="TARGET"       column="TARGET" />
			<result property="FIELDCD"      column="FIELDCD"  />
			<result property="FIELDNM"      column="FIELDNM" />
			<result property="BUSINESSCD"   column="BUSINESSCD" />
			<result property="UNITPRICE"    column="UNITPRICE" />
			<result property="CHARGE"       column="CHARGE" />
			<result property="TUTORPRICE"	column="TUTORPRICE" />
			<result property="EDUPRICE"     column="EDUPRICE" />
			<result property="CLASSPRICE"   column="CLASSPRICE" />
			<result property="BOOKPRICE"    column="BOOKPRICE" />
			<result property="ISCONFIRM"    column="ISCONFIRM" />
			<result property="REQUEST"      column="REQUEST" jdbcType="CLOB" javaType="java.lang.String" /> 
			<result property="EVALUTION"    column="EVALUTION" />
			<result property="INUSERID"     column="INUSERID" />
			<result property="INDATE"       column="INDATE" />
			<result property="LUSERID"      column="LUSERID" />
			<result property="LDATE"        column="LDATE"  />		
		</resultMap>
	<sql id="selectTzCompBasic">
		<![CDATA[
			 SELECT COMP, GUBUN, UPPERCOMP, GROUPYN, COMPRESNO, COMPNM, CONAME, TELNO, FAXNO, ADDR, ZIP, 
		             PREFIX, ISDELETED, FOREINTERYN,  APPLYCNT, COMPLOGO, TRAINORGNO, MANAGER, SALECHARGE, 
					 ENTERPRISEYN, BTOBYN, APPLYSTART, APPLYEND, COMPADDR, COMPLOGOBOTTOM, INUSERID, INDATE, CERTIFICATES
			 FROM T_LMS_COMPCLASS
		]]>
	</sql>
	
	<select id="selectTzCompPageList" resultClass="cmap" parameterClass="cmap" >
	    <include refid="pageingTop"/>
		SELECT COMP, GUBUN, DECODE(UPPERCOMP,'000000','',UPPERCOMP) UPPERCOMP, (SELECT COMPNM FROM T_LMS_COMPCLASS WHERE COMP = A.UPPERCOMP) GROUPNM, 
		         GROUPYN, COMPRESNO, COMPNM, CONAME, TELNO, FAXNO, ADDR, ZIP, 
	             PREFIX, ISDELETED, FOREINTERYN,  APPLYCNT, COMPLOGO, TRAINORGNO, MANAGER, SALECHARGE, 
				 ENTERPRISEYN, BTOBYN, APPLYSTART, APPLYEND, COMPADDR, COMPLOGOBOTTOM, INUSERID, INDATE, LUSERID, LDATE,
				 (SELECT COUNT(BUSINESSCD) FROM T_LMS_BUSINESSPLC WHERE COMP = A.COMP) BUSINESSPLCCNT, 0 SUBJCNT			 
		FROM T_LMS_COMPCLASS A
		WHERE A.GROUPYN = 'N'
    	<isNotEmpty property="l_uppercomp" prepend="AND">
			A.UPPERCOMP = #l_uppercomp# 
		</isNotEmpty>
		<isNotEmpty property="l_gubun" prepend="AND">
			A.GUBUN = #l_gubun# 	
		</isNotEmpty>			
	    <isNotEmpty property="l_search" prepend="AND">
		    $l_search$ LIKE '%'||#l_searchtxt#||'%'
		</isNotEmpty>
	    <isNotEmpty property="sortOrder" prepend="">
		    ORDER BY $sortOrder$
		</isNotEmpty>	
		<include refid="pageingBottom"/>	
	</select>	

	<select id="selectTzComp" resultClass="cmap" parameterClass="string">
	   <include refid="selectTzCompBasic"/>
		<![CDATA[
		  where COMP = #comp# 	
		]]>
	</select>

	<select id="selectUpperCompList" resultClass="cmap" parameterClass="string">
	   <include refid="selectTzCompBasic"/>
		<![CDATA[
		  where UPPERCOMP = #p_comp# 	
		]]>
	</select>

	<select id="selectIsComp" resultClass="cmap" parameterClass="string" >
		SELECT COUNT(COMP) COMPCNT			 
		FROM T_LMS_COMPCLASS A
		WHERE A.COMP = #p_comp#
	</select>	

	<insert id="insertTzComp" parameterClass="cmap" >
		<![CDATA[
			 INSERT INTO T_LMS_COMPCLASS(COMP, GUBUN, UPPERCOMP, GROUPYN, COMPRESNO, COMPNM, 
             CONAME, TELNO, FAXNO, ADDR, ZIP, 
             PREFIX, ISDELETED, FOREINTERYN,  APPLYCNT, 
			 COMPLOGO, TRAINORGNO, MANAGER, SALECHARGE, ENTERPRISEYN, 
			 BTOBYN, APPLYSTART, APPLYEND, COMPADDR, COMPLOGOBOTTOM,INUSERID, INDATE, CERTIFICATES) 																		
			 VALUES(#p_comp#,#p_gubun#,#p_uppercomp#,#p_groupyn#,#p_compresno#,#p_compnm#,
			 #p_coname#, #p_telno#, #p_faxno#, #p_addr#, #p_zip#, 
             #p_prefix#, 'N', #p_foreinteryn#,  #p_applycnt#, 
			 #p_complogo#, #p_trainorgno#, #p_manager#, #p_salecharge#, #p_enterpriseyn#, 
			 #p_btobyn#, #p_applystart#, #p_applyend#, #p_compaddr#, #p_complogobottom#, #s_userid#,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
			 #p_certificates#
			 )
		]]>
	</insert>
 
	<update id="updateTzComp" parameterClass="cmap" >
		<![CDATA[
			 UPDATE T_LMS_COMPCLASS SET  							
	             GUBUN = #p_gubun#, UPPERCOMP = #p_uppercomp#, GROUPYN=#p_groupyn#, COMPRESNO=#p_compresno#, COMPNM=#p_compnm#, 
	             CONAME=#p_coname#, TELNO=#p_telno#, FAXNO=#p_faxno#, ADDR=#p_addr#, ZIP=#p_zip#, 
	             PREFIX=#p_prefix#, FOREINTERYN=#p_foreinteryn#, APPLYCNT=#p_applycnt#, 
				 COMPLOGO=#p_complogo#, TRAINORGNO=#p_trainorgno#, MANAGER=#p_manager#, SALECHARGE=#p_salecharge#, ENTERPRISEYN=#p_enterpriseyn#, 
				 BTOBYN=#p_btobyn#, APPLYSTART=#p_applystart#, APPLYEND=#p_applyend#,COMPADDR=#p_compaddr#, COMPLOGOBOTTOM=#p_complogobottom#,
				 LUSERID=#s_userid#,LDATE=TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') 	, CERTIFICATES = #p_certificates#
			 WHERE COMP = #p_comp# 	
		]]>
	</update>

	<delete id="deleteTzComp" parameterClass="cmap" >
		<![CDATA[
			 UPDATE T_LMS_COMPCLASS SET ISDELETED = #p_isdeleted#	
			 WHERE COMP = #p_comp#				
		]]>
	</delete>

	<select id="selectPrefixCheck" resultClass="cmap" parameterClass="string">
	 	<![CDATA[
			 SELECT COUNT(COMP) COMPCNT 
			 FROM T_LMS_COMPCLASS 
			 WHERE GROUPYN = 'N' AND PREFIX = #prefix#	
		]]>
	</select>
	
	<select id="selectGroupList" resultClass="cmap" parameterClass="cmap" >
		SELECT COMP, GUBUN, UPPERCOMP, GROUPYN, COMPNM, INUSERID, INDATE, LUSERID, LDATE, ISDELETED
		FROM T_LMS_COMPCLASS
		WHERE GROUPYN = 'Y'
		ORDER BY COMPNM ASC
	</select>
	
	<select id="selectGroup" resultClass="cmap" parameterClass="string">
		<![CDATA[
		  SELECT COMP, COMPNM, ISDELETED
		  FROM T_LMS_COMPCLASS
		  where COMP = #comp# 	
		]]>
	</select>
	
	<insert id="insertGroup" parameterClass="cmap" >
		<![CDATA[
			 INSERT INTO T_LMS_COMPCLASS(COMP, UPPERCOMP, GROUPYN, COMPNM, INUSERID, INDATE) 																		
			 VALUES(#p_comp#,'000000','Y',#p_compnm#,
			  #s_userid#,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))
		]]>
	</insert>
 
	<update id="updateGroup" parameterClass="cmap" >
		<![CDATA[
			 UPDATE T_LMS_COMPCLASS SET  							
	             COMPNM=#p_compnm#, LUSERID=#s_userid#,LDATE=TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') 	
			 WHERE COMP = #p_comp# 	
		]]>
	</update>

	<update id="deleteGroup" parameterClass="cmap" >
		<![CDATA[
			 UPDATE T_LMS_COMPCLASS SET  							
	             ISDELETED = #p_isdeleted#, LUSERID=#s_userid#,LDATE=TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') 	
			 WHERE COMP = #p_comp# 	
		]]>
	</update>
	
	<update id="deleteGroupComp" parameterClass="cmap" >
		<![CDATA[
			 UPDATE T_LMS_COMPCLASS SET  							
	             ISDELETED = 'Y', LUSERID=#s_userid#, LDATE=TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') 	
			 WHERE UPPERCOMP = #p_comp# 	
		]]>
	</update>
	
	<sql id="selectBusinessPlcBasic">
		<![CDATA[
			SELECT COMP, BUSINESSCD, BUSINESSRESNO, BUSINESSNM, CONAME, TELNO, FAXNO, ADDR, ZIP, LUSERID, LDATE
			FROM T_LMS_BUSINESSPLC
		]]>
	</sql>

	<select id="selectBusinessPlcList" resultClass="cmap" parameterClass="string" >
        <include refid="selectBusinessPlcBasic"/>		
		WHERE COMP = #p_comp#
		ORDER BY BUSINESSNM ASC
	</select>
	
	<select id="selectBusinessPlcPageList" resultClass="cmap" parameterClass="cmap" >
	    <include refid="pageingTop"/>
			SELECT COMP,  GET_COMPNM(COMP) COMPNM, BUSINESSCD, BUSINESSRESNO, BUSINESSNM, CONAME, TELNO, FAXNO, ADDR, ZIP, LUSERID, LDATE
			FROM T_LMS_BUSINESSPLC
			WHERE COMP = #p_comp#
		    <isNotEmpty property="p_searchtext" prepend="AND">
			    $p_searchtype$ LIKE '%'||#p_searchtext#||'%'
			</isNotEmpty>
		    <isNotEmpty property="p_sortorder" prepend="">
			    ORDER BY $p_sortorder$
			</isNotEmpty>	
		<include refid="pageingBottom"/>	
	</select>	
	
	<select id="selectBusinessPlc" resultClass="cmap" parameterClass="cmap">
		<include refid="selectBusinessPlcBasic"/>
		<![CDATA[
		  where COMP = #p_comp# and BUSINESSCD = #p_businesscd#	
		]]>
	</select>
	
	<select id="selectIsBusinessPlc" resultClass="cmap" parameterClass="cmap">
		<![CDATA[
		  SELECT COUNT(BUSINESSCD) BUSINESSCNT
		  FROM T_LMS_BUSINESSPLC
		  WHERE COMP = #p_comp# and BUSINESSCD = #p_businesscd#	
		]]>
	</select>
	
	<insert id="insertBusinessPlc" parameterClass="cmap" >
		<![CDATA[
			 INSERT INTO T_LMS_BUSINESSPLC(COMP, BUSINESSCD, BUSINESSRESNO, BUSINESSNM, CONAME, TELNO, FAXNO, ADDR, ZIP, LUSERID, LDATE) 																		
			 VALUES(#p_comp#,#p_businesscd#,#p_businessresno#,#p_businessnm#,#p_coname#,
			  #p_telno#,#p_faxno#,#p_addr#,#p_zip#,#s_userid#,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))
		]]>
	</insert>
 
	<update id="updateBusinessPlc" parameterClass="cmap" >
		<![CDATA[
			 UPDATE T_LMS_BUSINESSPLC SET  							
	            BUSINESSRESNO = #p_businessresno#,BUSINESSNM = #p_businessnm#,CONAME = #p_coname#,
			    TELNO = #p_telno#,FAXNO = #p_faxno#,ADDR = #p_addr#,ZIP = #p_zip#, 
			    LUSERID=#s_userid#,LDATE=TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') 	
			 WHERE COMP = #p_comp# and BUSINESSCD = #p_businesscd#	
		]]>
	</update>		
		
	<update id="deleteBusinessPlc" parameterClass="cmap" >
		<![CDATA[
			 DELETE FROM T_LMS_BUSINESSPLC  							
			 WHERE COMP = #p_comp# and BUSINESSCD = #p_businesscd#	 
		]]>
	</update>
		
	<update id="deleteBusinessPlcComp" parameterClass="string" >
		<![CDATA[
			 DELETE FROM T_LMS_BUSINESSPLC  							
			 WHERE COMP = #p_comp# 
		]]>
	</update>		
		
	<select id="selectSubjMappingList" resultClass="cmap" parameterClass="cmap">
		<![CDATA[
			SELECT A.SUBJ, A.SUBJNM, A.ISONOFF,A.UPPERCLASS,A.MIDDLECLASS,A.LOWERCLASS,
				(SELECT CODENM FROM T_LMS_CODE WHERE GUBUN = '0001' AND CODE = A.ISONOFF) ISONOFFNM,
				(SELECT CLASSNAME FROM T_LMS_COMATT WHERE SUBJTYPE = 'C' AND UPPERCLASS = A.UPPERCLASS AND MIDDLECLASS = '0000' AND LOWERCLASS = '0000') UPPERNAME,
				(SELECT CLASSNAME FROM T_LMS_COMATT WHERE  SUBJTYPE = 'C' AND UPPERCLASS = A.UPPERCLASS AND MIDDLECLASS = A.MIDDLECLASS AND LOWERCLASS = '0000') MIDDLENAME,
				(SELECT CLASSNAME FROM T_LMS_COMATT WHERE SUBJTYPE = 'C' AND  UPPERCLASS = A.UPPERCLASS AND MIDDLECLASS = A.MIDDLECLASS AND LOWERCLASS = A.LOWERCLASS AND LOWERCLASS != '0000') LOWERNAME
			FROM T_LMS_SUBJ A
			WHERE A.ISUSE = 'Y' AND A.SUBJTYPE = 'C'
			AND A.SUBJ NOT IN (SELECT SUBJ FROM T_LMS_COMPCATEGORY WHERE COMP = #p_comp# )	
		]]>
		<isNotEmpty property="p_subjclass" prepend="AND">
			A.SUBJCLASS LIKE #p_subjclass#||'%' 
		</isNotEmpty>			
		<isNotEmpty property="p_isonoff" prepend="AND">
			A.ISONOFF = #p_isonoff# 
		</isNotEmpty>			
	    <isNotEmpty property="p_subjnm" prepend="AND">
		    A.SUBJNM LIKE '%'||#p_subjnm#||'%'
		</isNotEmpty>
		    ORDER BY SUBJNM
	</select>
	
	<select id="selectSubjMappedList" resultClass="cmap" parameterClass="cmap">
		<![CDATA[
			SELECT A.SUBJ, 
			       A.SUBJNM, 
			       A.ISONOFF,
			       A.UPPERCLASS,
			       A.MIDDLECLASS, 
			       A.LOWERCLASS, 
			       B.COMP,
			       B.APPLYCONTAINYN, 
			       B.EDUTYPE, 
			       B.BASETIME, 
			       B.EDULIMIT, 
			       B.AUTOAPPROVAL, 
			       B.USEYN,
			       B.CPPAY,
			       B.BIYONG,
			       B.LDATE,
			       A.SUBJTYPE,
			       B.CHASILIMIT,
			       B.CAPTCHA,
			       (SELECT CODENM 
			          FROM T_LMS_CODE 
			         WHERE GUBUN = '0014' 
			           AND CODE = B.EDUTYPE) EDUTYPENM,
				   (SELECT CODENM 
				      FROM T_LMS_CODE 
				     WHERE GUBUN = '0001' 
				       AND CODE = A.ISONOFF) ISONOFFNM,
				   (SELECT CLASSNAME 
				      FROM T_LMS_COMATT 
				     WHERE UPPERCLASS = A.UPPERCLASS 
				       AND MIDDLECLASS = '0000' 
				       AND LOWERCLASS = '0000'
				       AND SUBJTYPE = 'C') UPPERNAME,
				   (SELECT CLASSNAME 
				      FROM T_LMS_COMATT 
				     WHERE UPPERCLASS = A.UPPERCLASS 
				       AND MIDDLECLASS = A.MIDDLECLASS 
				       AND LOWERCLASS = '0000'
				       AND SUBJTYPE = 'C') MIDDLENAME,
				   (SELECT CLASSNAME 
				      FROM T_LMS_COMATT 
				     WHERE UPPERCLASS = A.UPPERCLASS 
				       AND MIDDLECLASS = A.MIDDLECLASS 
				       AND LOWERCLASS = A.LOWERCLASS 
				       AND LOWERCLASS != '0000'
				       AND SUBJTYPE = 'C') LOWERNAME,
				   (SELECT COMPNM 
				      FROM T_LMS_COMPCLASS 
				     WHERE COMP = B.COMP) COMPNM,
				   GET_SUBJJIKUP_NAME(B.COMP, B.SUBJ) MAPJIKUP
			  FROM T_LMS_SUBJ A, 
			  	   T_LMS_COMPCATEGORY B
			 WHERE A.SUBJ = B.SUBJ 
			   AND B.COMP = #p_comp# 
			   AND A.ISUSE = 'Y' 
			   AND B.USEYN = #p_useyn#]]>
		<isNotEmpty property="p_subjtype" prepend="AND">
			A.SUBJTYPE = #p_subjtype#||'%' 
		</isNotEmpty>					   
		<isNotEmpty property="p_subjclass" prepend="AND">
			A.SUBJCLASS LIKE #p_subjclass#||'%' 
		</isNotEmpty>			
		<isNotEmpty property="p_isonoff" prepend="AND">
			A.ISONOFF = #p_isonoff# 
		</isNotEmpty>			
		<isNotEmpty property="p_subjnm" prepend="AND">
		    A.SUBJNM LIKE '%'||#p_subjnm#||'%'
		</isNotEmpty>
	    ORDER BY SUBJNM
	</select>
	
	<select id="selectCompMappedCheck" resultClass="string" parameterClass="cmap">
		<![CDATA[
			SELECT COUNT(SUBJ) SUBJCNT
			FROM T_LMS_COMPCATEGORY
			WHERE COMP = #p_comp# AND SUBJ = #p_subj# 
		]]>
	</select>
				
	<update id="updateCompSubjCategory" parameterClass="cmap" >
		<![CDATA[
		UPDATE T_LMS_COMPCATEGORY 
		   SET EDUTYPE = #p_edutype#, 
		       BASETIME = #p_basetime#, 
		       EDULIMIT = #p_edulimit#, 
		       AUTOAPPROVAL = #p_autoapproval#,
		       BIYONG = #p_biyong#,
		       CPPAY = #p_cppay#,
		       CHASILIMIT = #p_chasilimit#,
		       CAPTCHA = #p_captcha#
		 WHERE COMP = #p_comp# 
		   AND SUBJ = #p_subj#
		]]>
	</update>

	<update id="updateCompCategoryUseyn" parameterClass="cmap" >
		<![CDATA[
		UPDATE T_LMS_COMPCATEGORY SET 
			USEYN = #p_useyn#
		WHERE COMP = #p_comp# AND  SUBJ = #p_subj#
		]]>
	</update>	
						
	<update id="deleteCompSubjCategoryAll" parameterClass="string" >
		<![CDATA[
		DELETE FROM T_LMS_COMPCATEGORY 
		WHERE COMP = #p_comp#
		]]>
	</update>					
	
	<insert id="insertSubjJikup" parameterClass="cmap" >
		<![CDATA[
			 INSERT INTO T_LMS_SUBJJIKUP(COMP, SUBJ, JIKUP, LUSERID, LDATE) 																		
			 VALUES(#p_comp#,#p_subj#,#p_jikup#,#s_userid#,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))
		]]>
	</insert>
     				
	<insert id="deleteSubjJikup" parameterClass="cmap" >
		<![CDATA[
			 DELETE FROM T_LMS_SUBJJIKUP 																		
			 WHERE COMP = #p_comp# AND SUBJ = #p_subj#
		]]>
	</insert>
	
	
	<select id="getCompIdpcdpyn" resultClass="string" parameterClass="string" >
		SELECT IDPCDPYN 
		FROM T_LMS_COMPCLASS 
		WHERE COMP=#value#   	
	</select>	
	
	<select id="selectCompByUser" resultClass="cmap" parameterClass="string" >
		SELECT COMP, GUBUN, UPPERCOMP, GROUPYN, COMPRESNO, COMPNM, CONAME, TELNO, FAXNO, ADDR, ZIP, 
		             PREFIX, ISDELETED, FOREINTERYN,  APPLYCNT, COMPLOGO, TRAINORGNO, MANAGER, SALECHARGE, 
					 ENTERPRISEYN, BTOBYN, APPLYSTART, APPLYEND, INUSERID, INDATE, LUSERID, LDATE
		FROM T_LMS_COMPCLASS 
		WHERE COMP IN (
			SELECT COMP 
			FROM T_LMS_MEMBER
			WHERE USERID = #value#
		)
	</select>	
<!-- CP/유통사 현황과 실적 등을 관리할 수 있는 모듈  -->
	<!-- 유통사 정보 리스트 가져오기 -->
 	<select id="externalSalesCompListCallBack" resultClass="cmap" parameterClass="cmap">
 	  <include refid="pageingTop"/>
        SELECT
        	COMP_SEQ
        	, COMPNM
        	, STARTYEAR
        	, ENDYEAR
        	, MANAGER
        	, MONITORINGID
        	, RESPONSIBILITIES
        	, TELEPHONE
        	, HANDPHONE
        	, EMAIL
        	, DECODE( MEMO, null, 'N', 'Y') ISMEMO
        	, LDATE
        FROM T_LMS_EXTERNALCOMP
        WHERE 1 = 1
        <isNotEmpty property="p_searchtext" prepend="AND">
		    UPPER($p_search$) LIKE '%'||UPPER(#p_searchtext#)||'%'
		</isNotEmpty>
		<isNotEmpty property="p_sortorder" prepend="">
			ORDER BY $p_sortorder$
		</isNotEmpty>
		<include refid="pageingBottom"/>
 	</select>
 	
 	<!-- 유통사 기본정보 가져오기 -->
 	<select id="externalSalesCompInfo" resultClass="cmap" parameterClass="cmap">
 		SELECT
        	COMP_SEQ
        	, COMPNM
        	, STARTYEAR
        	, ENDYEAR
        	, MANAGER
        	, MONITORINGID
        	, RESPONSIBILITIES
        	, TELEPHONE
        	, HANDPHONE
        	, EMAIL
        FROM T_LMS_EXTERNALCOMP
        WHERE 1 = 1
        	AND COMP_SEQ = #p_comp_seq#
 	</select>
 	
 	<!-- 유통사 컨텐츠 리스트 가져오기 -->
 	<select id="externalSalesContentsList" resultClass="cmap" parameterClass="cmap">
 		SELECT 
 			A.CONTSNM
       		, A.CONTSID 
  		FROM 
  			T_CDMS_CONTENTS A,
  			(SELECT CONTSID FROM T_LMS_EXTERNALCONTENTS WHERE COMPID = #p_comp_seq#) B
 		WHERE 1=1
 			AND A.CONTSID = B.CONTSID
 		ORDER BY A.CONTSID DESC
 	</select>
 	
 	<!-- 유통사 업체명 이미 존재하는지 확인 -->
 	<select id="checkExternalCompInfo" resultClass="cmap" parameterClass="cmap">
 		SELECT
        	COUNT(COMPNM) COUNT_COMPINFO
        FROM T_LMS_EXTERNALCOMP
        WHERE 1 = 1
        	AND COMPNM = UPPER(#p_compnm#)
 	</select>
 	
 	<!-- 유통사 정보 등록 -->
 	<insert id="insertExternalCompInfo" parameterClass="cmap">
 		INSERT INTO T_LMS_EXTERNALCOMP
 		(
 		COMP_SEQ
		, COMPNM
		, STARTYEAR
		, ENDYEAR
		, MANAGER
		, MONITORINGID
		, RESPONSIBILITIES
		, TELEPHONE
		, HANDPHONE
		, EMAIL
		, INUSERID
		, INDATE
		, LUSERID
		, LDATE
 		)
 		VALUES
 		(
 		(SELECT LPAD(NVL(MAX(COMP_SEQ),0)+1,7,'0') COMP_SEQ FROM T_LMS_EXTERNALCOMP)
		, UPPER(#p_compnm#)
		, #p_startyear#
		, #p_endyear#
		, #p_manager#
		, #p_monitoringid#
		, #p_responsibilities#
		, #p_telephone#
		, #p_handphone#
		, #p_email#
		, #s_userid#
		, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') 
		, #s_userid#
		, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
 		)
 	</insert>
 	
 	<!-- 등록한 유통사의 COMP_SEQ 가져오기 -->
 	<select id="checkExternalCompSeq" resultClass="cmap" parameterClass="cmap" >
 		SELECT
        	COMP_SEQ
        FROM T_LMS_EXTERNALCOMP
        WHERE 1 = 1
        	AND COMPNM = UPPER(#p_compnm#)
        	AND STARTYEAR = #p_startyear#
        	AND ENDYEAR = #p_endyear#
        	AND MANAGER = #p_manager#
        	AND MONITORINGID = #p_monitoringid#
 	</select>
 	
	<!-- 유통사가 해당 컨텐츠를 보유중인지 확인 -->
	<select id="checkExternalContentsInfo" resultClass="cmap" parameterClass="cmap" >
		SELECT 
			COUNT(CONTSID) COUNT_CONTENTSINFO
  		FROM 
  			T_LMS_EXTERNALCONTENTS
 		WHERE 1=1
 			AND	COMPID = #p_comp_seq#
 			AND CONTSID = #p_contsid#
	</select> 
	
	<!-- 유통사 컨텐츠 정보 등록 -->
 	<insert id="insertExternalContentsInfo" parameterClass="cmap" >
 		INSERT INTO T_LMS_EXTERNALCONTENTS
 		(
 		CONTENT_SEQ
		, COMPID
		, CONTSID
 		)
 		VALUES
 		(
 		(SELECT LPAD(NVL(MAX(CONTENT_SEQ),0)+1,7,'0') CONTENT_SEQ FROM T_LMS_EXTERNALCONTENTS)
		, #p_comp_seq#
		, #p_contsid#
 		)
 	</insert>
 	
 	<!-- 유통사 정보 수정 -->
 	<update id="updateExternalCompInfo" parameterClass="cmap">
 		UPDATE T_LMS_EXTERNALCOMP
			   SET 	COMPNM				= UPPER(#p_compnm#),
					STARTYEAR			= #p_startyear#,
					ENDYEAR				= #p_endyear#,
					MANAGER 			= #p_manager#,
					MONITORINGID 		= #p_monitoringid#,
					RESPONSIBILITIES 	= #p_responsibilities#,
					TELEPHONE			= #p_telephone#,
					HANDPHONE			= #p_handphone#,
					EMAIL				= #p_email#,
					LUSERID				= #s_userid#,
					LDATE				= TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
	         WHERE COMP_SEQ     = #p_comp_seq#  		
 	</update>
 	
 	<!-- 유통사 보유 컨텐츠 삭제 -->
 	<delete id="deleteExternalContentsInfo" parameterClass="cmap">
 		DELETE FROM T_LMS_EXTERNALCONTENTS 
 		WHERE 1=1
 			AND COMPID = #p_comp_seq#
 	</delete>
 	
 	<!-- 유통사 정보 삭제 -->
 	<delete id="deleteExternalCompInfo" parameterClass="cmap">
 		DELETE FROM T_LMS_EXTERNALCOMP 
 		WHERE 1=1
 			AND COMP_SEQ = #p_comp_seq#
 	</delete>
 	
 	<!-- 유통사 메모  select -->
	<select id="selectexternalCompMemo" resultClass="cmap" parameterClass="cmap" >
		SELECT	
			COMP_SEQ
    		, MEMO 
    		, COMPNM
		FROM 
			T_LMS_EXTERNALCOMP 
		WHERE COMP_SEQ = #p_comp_seq#
	</select>
	
	<!-- 유통사 메모 등록 -->
	<update id="updateExternalCompMemo" parameterClass="cmap"  >
		UPDATE T_LMS_EXTERNALCOMP
			  SET   MEMO = #p_memo#
		WHERE COMP_SEQ = #p_comp_seq#
	</update>

<!--  -->	
				
	<select id="selectCompSearchPageList" resultClass="cmap" parameterClass="cmap" >
        <include refid="pageingTop"/>
        SELECT DISTINCT A.COMP, A.COMPNM
        	, A.GUBUN
        	, ( SELECT CODENM FROM T_LMS_CODE WHERE GUBUN = '0004' AND CODE = A.GUBUN ) GUBUNNM
        	, A.COMPNM COMPANYNM
		FROM T_LMS_COMPCLASS A
		    , ( SELECT DISTINCT COMP, HGRCODE FROM T_LMS_HOMEPAGEGROUPCMP ) B
		WHERE A.COMP = B.COMP(+)
		    AND A.ISDELETED = 'N' 
		    AND A.GROUPYN = 'N'
		    AND A.GUBUN IN ('1')
    	<isNotEmpty property="p_hgrcode" prepend="AND">
		    B.HGRCODE = #p_hgrcode#
		</isNotEmpty>
 		<isNotEmpty property="p_searchtext" prepend="AND">
		    UPPER($p_search$) LIKE '%'||UPPER(#p_searchtext#)||'%'
		</isNotEmpty>
		<isNotEmpty property="p_sortorder" prepend="">
			ORDER BY $p_sortorder$
		</isNotEmpty>
		<include refid="pageingBottom"/>	
	</select>	

	<select id="selectDeptSearchPageList" resultClass="cmap" parameterClass="cmap" >
        <include refid="pageingTop"/>
		 SELECT COMP, DIVICOD, DEPTCOD, COMPNAM, DIVINAM, DEPTNAM
		 FROM  T_LMS_ORG
		 WHERE 1=1
 		<isNotEmpty property="p_searchtext" prepend="AND">
		    $p_search$ LIKE '%'||#p_searchtext#||'%'
		</isNotEmpty>
		<isNotEmpty property="p_sortorder" prepend="">
			ORDER BY $p_sortorder$
		</isNotEmpty>
		<include refid="pageingBottom"/>	
	</select>			
					
	<select id="selectIsCompSubjCheck" resultClass="cmap" parameterClass="cmap">
		<![CDATA[
			SELECT SUBJNM, COUNT(B.SUBJ) SUBJCNT
			FROM T_LMS_SUBJ A, T_LMS_COMPCATEGORY B
			WHERE A.SUBJ = B.SUBJ(+) AND B.COMP(+) = #comp# AND A.SUBJ = #p_subj#
			GROUP BY SUBJNM		
		]]>
	</select>

	<select id="selectCompSetting" resultClass="cmap" parameterClass="cmap">
		<![CDATA[
		 SELECT APPLYCONTAINYN, EDUTYPE, BASETIME, EDULIMIT, AUTOAPPROVAL, CHASILIMIT, CAPTCHA
		 FROM T_LMS_COMPCATEGORY 
		 WHERE comp =  #s_comp# AND subj = #s_subj#
		]]>
	</select>
					
	<!--  교육그룹에 속한 회사코드(명)  목록을 가져온다. -->				
	<select id="selectGrCompList" resultClass="cmap" parameterClass="string">
		<![CDATA[
			SELECT A.COMP CODE , A.COMPNM||DECODE(A.GROUPYN,'Y','(G)') AS CODENM
                FROM T_LMS_COMPCLASS A, T_LMS_GRCOMP B
                WHERE A.COMP = B.COMP
                AND B.GRCODE=#value#
		]]>
	</select>
	
	<select id="selectFostertrainingPageList" resultClass="cmap" parameterClass="cmap" >
        <include refid="pageingTop"/>
		SELECT FOSTERSEQ    ,
			   BUSINESSNM   ,
		       COUNSELDATE  ,
		       REGIONCD     ,
		       REGIONNM     ,
		       NAME         ,
		       JIKUPNM      ,
		       DEPTNM       ,
		       TELNO        ,
		       HANDPHONE    ,
		       EMAIL        ,
		       PERIODS      ,
		       PERIODE      ,
		       TOTALTIME    ,
		       DAYS         ,
		       WEEKDAY      ,
		       TIMESLOT     ,
		       FOSTERNO     ,
		       PLACE        ,
		       ISGOYONG     ,
		       RCVARADDR    ,
		       CONTENTS     ,
		       TARGET       ,
		       FIELDCD      ,
		       FIELDNM      ,
		       BUSINESSCD   ,
		       UNITPRICE    ,
		       CHARGE       ,
		       TUTORPRICE   ,
		       EDUPRICE     ,
		       CLASSPRICE   ,
		       BOOKPRICE    ,
		       ISCONFIRM    ,
			   EVALUTION    ,
			   INUSERID     ,
			   INDATE       ,
		       LUSERID      ,
		       LDATE    
		  FROM T_LMS_FOSTERTRAINING  
		 WHERE 1 = 1  
 		<isNotEmpty property="p_searchtext">
		   AND $p_search$ LIKE '%'||#p_searchtext#||'%'
		</isNotEmpty>		  
 		<isNotEmpty property="p_counselyear" >
		   AND COUNSELDATE BETWEEN #p_counselstartdate# AND #p_counselenddate#       
		</isNotEmpty>
 		<isNotEmpty property="p_fieldcd" >
		   AND FIELDCD = #p_fieldcd#       
		</isNotEmpty>
 		<isNotEmpty property="p_isconfirm" >
		   AND ISCONFIRM = #p_isconfirm#       
		</isNotEmpty>
 		<isNotEmpty property="p_businesscd" >
		   AND BUSINESSCD = #p_businesscd#       
		</isNotEmpty>	
	  ORDER BY COUNSELDATE DESC 
		
		<include refid="pageingBottom"/>	
	</select>
	
	<select id="selectExcelFostertrainingPageList" resultClass="cmap" parameterClass="cmap" >
			  SELECT FOSTERSEQ    ,
				     BUSINESSNM   ,
				     COUNSELDATE  ,
				     GET_FOSTER_PROG(FOSTERSEQ) PROGNM, 
				     DECODE(REGIONCD, '99', REGIONNM , GET_CODENM('0117', REGIONCD) ) REGIONNM,
				     NAME         ,
				     JIKUPNM      ,
				     DEPTNM       ,
				     TELNO        ,
				     HANDPHONE    ,
				     EMAIL        ,
				     PERIODS      ,
				     PERIODE      ,
				     TOTALTIME    ,
				     DAYS         ,
				     WEEKDAY      ,
				     TIMESLOT     ,
				     FOSTERNO     ,
				     PLACE        ,
				     ISGOYONG     ,
				     RCVARADDR    ,
				     CONTENTS     ,
				     TARGET       ,
				     DECODE(FIELDCD, '99', FIELDNM , GET_CODENM('0115', FIELDCD) ) FIELDNM,
				     GET_CODENM('0116', BUSINESSCD) BUSINESSNM ,
				     UNITPRICE    ,
				     CHARGE       ,
				     TUTORPRICE   ,
				     EDUPRICE     ,
				     CLASSPRICE   ,
				     BOOKPRICE    ,
				     ISCONFIRM    
				FROM T_LMS_FOSTERTRAINING  
			   WHERE 1 = 1  
	 		<isNotEmpty property="p_searchtext">
			     AND $p_search$ LIKE '%'||#p_searchtext#||'%'
			</isNotEmpty>		  
	 		<isNotEmpty property="p_counselyear" >
			     AND COUNSELDATE BETWEEN #p_counselstartdate# AND #p_counselenddate#       
			</isNotEmpty>
	 		<isNotEmpty property="p_fieldcd" >
			     AND FIELDCD = #p_fieldcd#       
			</isNotEmpty>
	 		<isNotEmpty property="p_isconfirm" >
			     AND ISCONFIRM = #p_isconfirm#       
			</isNotEmpty>
	 		<isNotEmpty property="p_businesscd" >
			     AND BUSINESSCD = #p_businesscd#       
			</isNotEmpty>	
			ORDER BY COUNSELDATE DESC 
	</select>
		
	<select id="getFosterTraining" resultMap="selectFostertraining" parameterClass="string" >
		SELECT FOSTERSEQ    ,
			   BUSINESSNM   ,
		       COUNSELDATE  ,
		       REGIONCD     ,
		       REGIONNM     ,
		       NAME         ,
		       JIKUPNM      ,
		       DEPTNM       ,
		       TELNO        ,
		       HANDPHONE    ,
		       EMAIL        ,
		       PERIODS      ,
		       PERIODE      ,
		       TOTALTIME    ,
		       DAYS         ,
		       WEEKDAY      ,
		       TIMESLOT     ,
		       FOSTERNO     ,
		       PLACE        ,
		       ISGOYONG     ,
		       RCVARADDR    ,
		       CONTENTS     ,
		       TARGET       ,
		       FIELDCD      ,
		       FIELDNM      ,
		       BUSINESSCD   ,
		       UNITPRICE    ,
		       CHARGE       ,
		       TUTORPRICE   ,
		       EDUPRICE     ,
		       CLASSPRICE   ,
		       BOOKPRICE    ,
		       ISCONFIRM    ,
		       REQUEST	    ,
			   EVALUTION    ,
			   INUSERID     ,
			   INDATE       ,
		       LUSERID      ,
		       LDATE    
		  FROM T_LMS_FOSTERTRAINING  
		 WHERE FOSTERSEQ = #p_fosterseq#
	</select>

	<select id="selectMemoFostertraining" resultClass="string" parameterClass="string" >
		SELECT EVALUTION
		  FROM T_LMS_FOSTERTRAINING  
		 WHERE FOSTERSEQ = #p_fosterseq#
	</select>
	
	<select id="getMaxFoster" resultClass="string" >
		SELECT NVL(MAX(FOSTERSEQ),0) + 1
		  FROM T_LMS_FOSTERTRAINING  
	</select>
	
	<delete id="deleteFostertraining"  parameterClass="string" >
		DELETE 
		  FROM T_LMS_FOSTERTRAINING  
		 WHERE FOSTERSEQ = #p_fosterseq#
	</delete>	
			
	<insert id="insertFostertraining" parameterClass="cmap" >
			   INSERT INTO T_LMS_FOSTERTRAINING(FOSTERSEQ    ,
											 	BUSINESSNM   ,
												COUNSELDATE  ,
												REGIONCD     ,
												REGIONNM     ,
												NAME         ,
												JIKUPNM      ,
												DEPTNM       ,
												TELNO        ,
												HANDPHONE    ,
												EMAIL        ,
												PERIODS      ,
												PERIODE      ,
												TOTALTIME    ,
												DAYS         ,
												WEEKDAY      ,
												TIMESLOT     ,
												FOSTERNO     ,
												PLACE        ,
												ISGOYONG     ,
												RCVARADDR    ,
												CONTENTS     ,
												TARGET       ,
												FIELDCD      ,
												FIELDNM      ,
												BUSINESSCD   ,
												UNITPRICE    ,
												CHARGE       ,
												TUTORPRICE   ,
												EDUPRICE     ,
												CLASSPRICE   ,
												BOOKPRICE    ,
												ISCONFIRM    ,
												REQUEST      ,
												EVALUTION    ,
												INUSERID     ,
												INDATE       ,
												LUSERID      ,
												LDATE        ) 																		
										 VALUES(#p_fosterseq#,
												#p_businessnm#,
												#p_counseldate#,
												#p_regioncd#,
												#p_regionnm#,
												#p_name#,
												#p_jikupnm#,
												#p_deptnm#,
												#p_telno#,
												#p_handphone#,
												#p_email#,
												#p_periods#,
												#p_periode#,
												#p_totaltime#,
												#p_days#,
												#p_weekday#,
												#p_timeslot#,
												#p_fosterno#,
												#p_place#,
												#p_isgoyong#,
												#p_rcvaraddr#,
												#p_contents#,
												#p_target#,
												#p_fieldcd#,
												#p_fieldnm#,
												#p_businesscd#,
												#p_unitprice#,
												#p_charge#,
												#p_tutorprice#,
												#p_eduprice#,
												#p_classprice#,
												#p_bookprice#,
												#p_isconfirm#,
												#p_request#,
												#p_evalution#,
												#p_inuserid#,
												TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
												#p_luserid#,
												TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') )
	</insert>	
	
	
	<update id="updateFostertraining" parameterClass="cmap" >
			UPDATE T_LMS_FOSTERTRAINING
			   SET BUSINESSNM   = #p_businessnm#,
			       COUNSELDATE  = #p_counseldate#,
			       REGIONCD     = #p_regioncd#,
			       REGIONNM     = #p_regionnm#,
			       NAME         = #p_name#,
			       JIKUPNM      = #p_jikupnm#,
			       DEPTNM       = #p_deptnm#,
			       TELNO        = #p_telno#,
			       HANDPHONE    = #p_handphone#,
			       EMAIL        = #p_email#,
			       PERIODS      = #p_periods#,
			       PERIODE      = #p_periode#,
			       TOTALTIME    = #p_totaltime#,
			       DAYS         = #p_days#,
			       WEEKDAY      = #p_weekday#,
			       TIMESLOT     = #p_timeslot#,
			       FOSTERNO     = #p_fosterno#,
			       PLACE        = #p_place#,
			       ISGOYONG     = #p_isgoyong#,
			       RCVARADDR    = #p_rcvaraddr#,
			       CONTENTS     = #p_contents#,
			       TARGET       = #p_target#,
			       FIELDCD      = #p_fieldcd#,
			       FIELDNM      = #p_fieldnm#,
			       BUSINESSCD   = #p_businesscd#,
			       UNITPRICE    = #p_unitprice#,
			       CHARGE       = #p_charge#,
			       TUTORPRICE   = #p_tutorprice#,
			       EDUPRICE     = #p_eduprice#,
			       CLASSPRICE   = #p_classprice#,
			       BOOKPRICE    = #p_bookprice#,
				   ISCONFIRM    = #p_isconfirm#,
			 	   REQUEST      = #p_request#,
				   EVALUTION    = #p_evalution#,
			       LUSERID      = #p_luserid#,
				   LDATE        = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
	         WHERE FOSTERSEQ     = #p_fosterseq# 		  																
	</update>
	<update id="updateMemoFostertraining" parameterClass="cmap" >
			UPDATE T_LMS_FOSTERTRAINING
			   SET EVALUTION = #p_memo#,
			       LUSERID   = #p_luserid#,
				   LDATE     = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
	         WHERE FOSTERSEQ  = #p_fosterseq#		  																
	</update>	
	
	<insert id="insertFosterprog"  parameterClass = "map">
		INSERT INTO T_LMS_FOSTERPROG( FOSTERSEQ,
		                      		  PROGSEQ,
		                      		  PROGCD )  		  
		              		  VALUES( #p_fosterseq#,
		              		          #p_progseq#,
		                       		  #p_progcd#)
	</insert>
	<delete id="deleteFosterprog"  parameterClass="string">
		DELETE FROM T_LMS_FOSTERPROG
			  WHERE FOSTERSEQ = #p_fosterseq#
	</delete>
	
	<select id="getFosterprog" parameterClass = "string" resultClass="cmap"  >
             SELECT  NVL(MIN(DECODE(AA.PROGCD, '01', 'Y') ),'N') PROGCD01,
		       		 NVL(MIN(DECODE(AA.PROGCD, '02', 'Y') ),'N') PROGCD02,
                     NVL(MIN(DECODE(AA.PROGCD, '03', 'Y') ),'N') PROGCD03,
                     NVL(MIN(DECODE(AA.PROGCD, '04', 'Y') ),'N') PROGCD04,
                     NVL(MIN(DECODE(AA.PROGCD, '05', 'Y') ),'N') PROGCD05,
                     NVL(MIN(DECODE(AA.PROGCD, '06', 'Y') ),'N') PROGCD06,
                     NVL(MIN(DECODE(AA.PROGCD, '07', 'Y') ),'N') PROGCD07,
                     NVL(MIN(DECODE(AA.PROGCD, '08', 'Y') ),'N') PROGCD08,                                                                                    
                     NVL(MIN(DECODE(AA.PROGCD, '09', 'Y') ),'N') PROGCD09,
                     NVL(MIN(DECODE(AA.PROGCD, '10', 'Y') ),'N') PROGCD10                
               FROM ( SELECT PROGCD
                        FROM T_LMS_FOSTERPROG
                       WHERE FOSTERSEQ = #value# ) AA,
                    (SELECT CODE,
                             CODENM
                       FROM T_LMS_CODE
                      WHERE GUBUN = '0120' ) BB
                WHERE PROGCD(+) = BB.CODE
	</select>			
</sqlMap>